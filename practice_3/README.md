# –û—Ç—á–µ—Ç –ü–ó 3

## üîπ –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

* –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–≤–æ–ª—å–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä
* –í—Å—Ç–∞–≤–∏—Ç—å –≤ —è–¥—Ä–æ
* –°–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
* –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

---

## üîπ –•–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ –¥—Ä–∞–π–≤–µ—Ä–∞

–ë—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥—Ä–∞–π–≤–µ—Ä **simple_char.c**, –∫–æ—Ç–æ—Ä—ã–π:

* –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å –ø–æ–º–æ—â—å—é `alloc_chrdev_region()`;
* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `cdev` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –µ—ë —á–µ—Ä–µ–∑ `cdev_add()`;
* –°–æ–∑–¥–∞—ë—Ç –∫–ª–∞—Å—Å –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ `/dev` —Å –ø–æ–º–æ—â—å—é `class_create()` –∏ `device_create()`;
* –†–µ–∞–ª–∏–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `open()`, `release()` –∏ `read()`.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏:**

```c
dev_t dev_num;
struct cdev simple_cdev;
struct class *simple_class;
struct device *simple_device;
```

---

### 2. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –º–æ–¥—É–ª—è

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `Makefile`:

```makefile
obj-m += simple_char.o

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules
```

–ö–æ–º–ø–∏–ª—è—Ü–∏—è:

```bash
make
```

---

### 3. –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è

```bash
sudo insmod simple_char.ko
dmesg | tail
```

–í—ã–≤–æ–¥ —è–¥—Ä–∞:

![alt text](loading_module.png "–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è –≤ —è–¥—Ä–æ")

---

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è:

![alt text](ls_module.png "–î—Ä–∞–π–≤–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ dev")

---

### 5. –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `/dev/`, —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑ –Ω–µ–≥–æ –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `read()` –∏ –≤—ã–≤–æ–¥–∏—Ç –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –Ω–∞ —ç–∫—Ä–∞–Ω.
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –æ–Ω–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º —è–¥—Ä–∞.

![alt text](running_app.png "–ó–∞–ø—É—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")


---

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤—ã–≥—Ä—É–∑–∫–∞

```bash
lsmod | grep simple_char
sudo rmmod simple_char
dmesg | tail
```

–í—ã–≤–æ–¥:

![alt text](dmesg_after_app_running.png "–í—ã–≥—Ä—É–∑–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞")


---

## üîπ –í—ã–≤–æ–¥
 
–í —Ö–æ–¥–µ —Ä–∞–±–æ—Ç—ã –±—ã–ª —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Å–∏–º–≤–æ–ª—å–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä —è–¥—Ä–∞ Linux.
–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–π **class_create()** –∏ **device_create()**
